<!--

	Antti Luoto - Tampere University of Technology
	Project - Need4Speed
	ophi-stat-vis.html - html for outputing operation history statistics
	Customer - NSN
	Date - 8.6.2015

-->

<!doctype html>
<html lang="en">
<head>
	<title>OpHi - Top 10</title>
	<script src="../dist/js/d3.min.js"></script>

</head>
<body onLoad='chart(data);'>
<script>d3.select("body").append("h1").text("Operation History - Longest Lasting - Top 10");
</script>

<script>
	//Width and height
function chart(dataset) {
	var w = 1200;
	//var h = d3.max(dataset,function(d){return d.value; }) + 30;
	var h = 500;
	var barPadding = 1;
	
	//top 10
	var dataset = [];
	for(var i = 0; i < 10; ++i)
	{
		//data array is generated on top of the file when giving the page as http response
		dataset.push(data[i]);
	}

	//var dataset = [ 2, 1, 1, 1, 1, 1, 1, 1, 1, 6,
	//				20, 1, 7 ];
	//alert(JSON.stringify(dataset));
	//var dataset = [{value: 20, label: "test1", id: 1}, {value: 10, label: "test2", id: 2}];

	//Create SVG element
	var svg = d3.select("body")
				.append("svg")
				.attr("width", w)
				.attr("height", h);

	svg.selectAll("rect")
	   .data(dataset)
	   .enter()
	   .append("rect")
	   .attr("x", function(d, i) {
	   		return i * (w / dataset.length);
	   })
	   .attr("y", function(d) {
	   		return h - (d.exeTime / 1000);
	   })
	   .attr("width", w / dataset.length - barPadding)
	   .attr("height", function(d) {
	   		return d.exeTime * 1;
	   })
	   .attr("fill", function(d) {
			return "rgb(0, 0, " + (Math.floor(d.exeTime) * 5) + ")";
	   });

	svg.selectAll("text")
	   .data(dataset)
	   .enter()
	   .append("text")
	   .text(function(d) {
	   		return d.exeTime / 1000;
	   })
	   .attr("text-anchor", "middle")
	   .attr("x", function(d, i) {
	   		return i * (w / dataset.length) + (w / dataset.length - barPadding) / 2;
	   })
	   .attr("y", function(d) {
	   		return h - (d.exeTime / 1000) + 14;
	   })
	   .attr("font-family", "sans-serif")
	   .attr("font-size", "11px")
	   .attr("fill", "white");


		var padding = w;
	   /*
	   var yScale = d3.scale.linear().domain([0, d3.max(dataset,function(d){return d.value; })])
	   								.range([0, h]);
		var padding = w;
		var yAxis = d3.svg.axis().scale(yScale).orient("left").ticks(20);
		svg.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(" + padding + ",0)")
			.call(yAxis);
		*/
	   //var xScale = d3.scale.ordinal().domain([0, d3.max(dataset,function(d){return d.label; })])
	   //								.range([0, w]);
	   var labels = [];
	   var ids = [];
	   	for (var i in dataset)
	   	{
	   		labels[i] = dataset[i].type + " " + dataset[i].id;
	   	}

	   var xScale = d3.scale.ordinal().domain( labels )
	   								.rangeBands([0, w]);
		var padding = 10;
		var xAxis = d3.svg.axis().scale(xScale).orient("bottom");
		svg.append("g")
			.attr("class", "axis")
			.attr("transform", "translate(0, 0)")
			.style("font-size","11px")
			.call(xAxis);			
}

	
</script>

<!--
<form action="/upload", method="post", enctype="multipart/form-data">
	<p>Choose CSV log file:<p>
  	<input type="file" name="upload-file">
  	<input type="submit" value="Upload">
</form>
-->

<p>Y axis - Execution time in seconds</p>
<p>X axis - Operation type and ID</p>


